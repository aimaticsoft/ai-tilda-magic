

# Оптимизация производительности сайта

## Диагностика: почему сайт "тормозит"

Проанализировав код, я нашёл несколько серьёзных узких мест, которые вместе создают эффект "30 FPS":

### 1. Canvas-частицы с O(n^2) алгоритмом (самая тяжёлая проблема)
`ParticlesBackground.tsx` — на экране 1920x1080 создаётся ~138 частиц. Для каждой частицы проверяются связи со ВСЕМИ остальными — это ~19 000 вычислений расстояний **каждый кадр** (60 раз в секунду). Это классическая O(n^2) проблема.

### 2. FloatingElement — трекинг мыши без throttle
`useMousePosition` вызывает `setState` на КАЖДОЕ событие `mousemove` (сотни раз в секунду). А `FloatingElement` используется ~8+ раз на странице — каждое движение мыши вызывает ре-рендер всех этих компонентов одновременно.

### 3. Слишком много одновременных Framer Motion анимаций
- `ParallaxBackground` — 11 анимируемых элементов с `useTransform` и `useSpring`
- `AnimatedSection` — каждый экземпляр создаёт `useScroll` + `useSpring` + 3 `useTransform`
- `ParallaxText` — `useAnimationFrame` работает каждый кадр
- Все секции используют `motion.div` с `whileHover`, `animate`, `variants`
- В сумме на странице одновременно работают 50+ анимированных элементов

### 4. Тяжёлые CSS-эффекты
- `backdrop-blur-xl` на каждой `glass-card` — blur очень дорогой для GPU
- `blur-[128px]` на больших элементах в Hero
- `animated-grid` с бесконечной CSS-анимацией
- `box-shadow` на hover карточек

---

## План оптимизации

### Шаг 1: Убрать/упростить ParticlesBackground
Заменить canvas с O(n^2) линиями на простые CSS-точки или вовсе убрать. Частицы красивые, но они — главный источник подтормаживания. Варианты:
- **Вариант A (рекомендуется):** Уменьшить количество частиц в 3 раза, убрать линии связей между ними
- **Вариант B:** Заменить на статичные CSS-точки с простой анимацией
- **Вариант C:** Полностью убрать

### Шаг 2: Оптимизировать FloatingElement и useMousePosition
- Добавить `throttle` к обработчику `mousemove` (обновлять не чаще 1 раза в 50мс)
- Использовать `useMotionValue` вместо `useState` — это позволит анимировать без ре-рендеров React

### Шаг 3: Упростить ParallaxBackground
- Сократить с 11 до 4-5 элементов
- Убрать `useSpring`-обёртки (они создают дополнительные вычисления каждый кадр)
- Убрать `rotate` и `scale` трансформации — оставить только `y`

### Шаг 4: Упростить AnimatedSection
- Убрать `useSpring` — использовать `useTransform` напрямую (менее плавно, но значительно легче)
- Убрать `scale` трансформацию — оставить только `opacity` и `y`

### Шаг 5: Снизить нагрузку CSS
- Заменить `backdrop-blur-xl` на `backdrop-blur-md` или убрать blur и использовать полупрозрачный фон
- Уменьшить `blur-[128px]` на Hero-орбах до `blur-[80px]`
- Убрать `animated-grid` CSS-анимацию (бесконечно двигающаяся сетка) или сделать её статичной

### Шаг 6: Убрать лишние hover-анимации
- Убрать `whileHover={{ scale, rotateY, rotateX }}` с карточек — оставить простой CSS `hover:scale-[1.02]`
- Убрать `perspective-1000` с карточек услуг

---

## Техническая детализация

### ParticlesBackground.tsx
```
- Снизить particleCount: делить на 25000 вместо 15000
- Убрать вложенный цикл линий (строки 67-81)
- Это даст прирост от ~19000 до ~80 операций/кадр
```

### useMousePosition.ts
```
- Заменить useState на useMotionValue
- Добавить requestAnimationFrame-throttle
- FloatingElement будет анимировать через motion values без setState
```

### ParallaxBackground.tsx
```
- Убрать rotate1, rotate2, scale1, scale2
- Оставить 4-5 элементов вместо 11
- Убрать animated-grid overlay
```

### AnimatedSection.tsx
```
- Убрать useSpring обёртку
- Убрать scale трансформацию
- Упрощённые opacity + y через useTransform
```

### index.css
```
- backdrop-blur-xl -> backdrop-blur-sm
- Убрать animation: gridMove из animated-grid
- blur-[128px] -> blur-[80px] в HeroSection
```

### Все секции (Services, Cases, Advantages и др.)
```
- Убрать whileHover с 3D-трансформациями (rotateY, rotateX)
- Заменить на простой CSS hover
- Убрать вложенные FloatingElement где они не нужны
```

---

## Ожидаемый результат
- Снижение нагрузки на CPU в 3-5 раз
- Плавный 60fps скролл на большинстве устройств
- Визуально сайт останется почти таким же — просто будут убраны незаметные для глаза, но тяжёлые эффекты

